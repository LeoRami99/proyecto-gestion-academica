{%extends "base.html"%}
{%block title%}Cursos{%endblock%}
{% block navbar %}
<!-- navbar -->
<nav class="navbar navbar-expand-lg sticky-top fondo_navbar" data-aos="fade-down" data-aos-duration="1000">
  <div class="container-fluid">
    <a class="navbar-brand" href="/" style="color:#ffffff;">Nombre del sistema sistema | {{current_user.nombre}}</a>
    <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="#navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <i class="bi bi-list"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#" style="color:#ffffff;">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" style="color:#ffffff;">Features</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" style="color:#ffffff;">Pricing</a>
        </li>
      </ul> -->
  </div>
  <div class="d-flex">
    <!-- <a href="{{url_for('login_page.logout')}}" class="btn btn-outline-light me-2" role="button"
      aria-pressed="true">Cerrar sesión</a> -->
    <button class="btn t" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"
      aria-controls="offcanvasExample">
      <i class="bi bi-list" style="font-size: 30px; color: #ffffff;"></i>
    </button>
  </div>
  </div>
</nav>
{% endblock %}
{%block content%}
<!-- Offcanva -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasExampleLabel">Nombre del sistema</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div>
      <div class="d-flex">
        <img src="https://cdn.pixabay.com/photo/2016/11/29/09/41/bag-1868758_960_720.jpg" class="rounded-circle"
          alt="..." height="100px" width="100px">
        <div class="ms-3">
          <h5>{{current_user.nombre}} {{current_user.apellido}}</h5>
          <p>{{nombre_cliente}}</p>
        </div>
      </div>
      <hr>
      <div class="">
        <div class="text-center">
          <a href="{{url_for('login_page.logout')}}" class="btn btn-outline-dark me-2" role="button"
            aria-pressed="true">Cerrar sesión</a>
          <hr>
        </div>
        <div class="accordion accordion-flush" id="accordionFlushExample">
          <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingOne">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                <i class="bi bi-mortarboard"></i>
                <strong>
                  Cursos
                </strong>
              </button>
            </h2>
            <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
              data-bs-parent="#accordionFlushExample">
              <!-- Lista de botonos -->
              <div class="accordion-body">
                <div class="btn-group-vertical w-100 g-3" role="group" aria-label="Vertical button group">
                  <a type="button" class="btn btn-dark">Cursos activos</a>
                  <a type="button" class="btn btn-dark">cursos no activos</a>
                  <a type="button" class="btn btn-dark">Registrar curso</a>
                </div>
              </div>

            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingTwo">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                Accordion Item #2
              </button>
            </h2>
            <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo"
              data-bs-parent="#accordionFlushExample">
              <div class="accordion-body">Placeholder content for this accordion, which is intended to demonstrate the
                <code>.accordion-flush</code> class. This is the second item's accordion body. Let's imagine this being
                filled with some actual content.
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingThree">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                Accordion Item #3
              </button>
            </h2>
            <div id="flush-collapseThree" class="accordion-collapse collapse" aria-labelledby="flush-headingThree"
              data-bs-parent="#accordionFlushExample">
              <div class="accordion-body">Placeholder content for this accordion, which is intended to demonstrate the
                <code>.accordion-flush</code> class. This is the third item's accordion body. Nothing more exciting
                happening here in terms of content, but just filling up the space to make it look, at least at first
                glance, a bit more representative of how this would look in a real-world application.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- titulo -->
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="text-center">
        <h1 class="display-4">Cursos</h1>
      </div>
    </div>
  </div>
  <!-- Lista de cursos en cards-->
  <!-- Barra de busqueda para filtrar las cards -->
  <div class="row">
    <div class="col-12">
      <div class="input-group flex-nowrap mb-3 w-25 float-end">
        <span class="input-group-text" id="addon-wrapping"><i class="bi bi-search"></i></span>
        <input type="text" class="form-control" id="Buscar" placeholder="Buscar" aria-label="Buscar"
          aria-describedby="addon-wrapping">
      </div>
    </div>
  </div>




  <div class="row row-cols-1 row-cols-md-3 g-4" id="listado">
    {% for curso in cursos%}
    {% if curso[14] == 1 %}
    <div class="col mb-5">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title titulo"><i class="bi bi-mortarboard"></i> {{curso[1]}}</h5>
        </div>
        <div class="card-body">
          <b>Código del curso:</b> {{curso[2]}}
          <br>
          <b>Fecha inicio:</b> {{curso[3]}}
          <br>
          <b>Fecha finalización:</b> {{curso[4]}}
          <br>
          <b>Horario:</b> {{curso[5]}}
          <br>
          <b>Modalidad:</b> {{curso[6]}}
          <br>
          <b>Duración:</b> {{curso[7]}}
          <br>
          <b>Intensidad horaria:</b> {{curso[8]}}
          <br>
          <b>Cantidad de sesiones:</b> {{curso[9]}}
          <br>
          <b>Cupo:</b> {{curso[10]}}
          <br>
          <b>Enlace de la clase:</b> {{curso[11]}}
          <br>
          <b>Enlace de las grabaciones:</b> {{curso[12]}}
          <br>
          <b>Enlaces formulario asistencia:</b> {{curso[13]}}
          <br>
          <b>Docente: </b> {{curso[16]}}
          <br>
        </div>
        <div class="card-footer">
          {% if curso[14] == 1 %}
          <span class="badge rounded-pill text-bg-success card-text"><i class="bi bi-check"></i> | Activo</span>
          {% else %}
          <p class="card-text">No activo</p>
          {% endif %}
          {%if current_user.rol == "AD"%}
          <div class="btn-group float-end" role="group" aria-label="Botones de edición">
            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modal_curso"
              data-bs-whateve="{{curso[0]}}"><i class="bi bi-pencil"></i></button>
            <!-- <button type="button" class="btn btn-outline-danger"><i class="bi bi-trash"></i></button> -->
          </div>
          <form action="{{url_for('cursos.generar_informe')}}" method="post">
            <input type="hidden" name="id_curso" value="{{curso[0]}}">
            <button type="submit" class="btn btn-outline-success"><i class="bi bi-filetype-xlsx"></i></button>
          </form>
          {%else%}
          {% endif %}

        </div>
      </div>
    </div>
    {%else%}
    {% endif %}
    {% endfor %}
  </div>
  <!-- Paginacion de las cards de los cursos -->
  <div class="container-fluid">
    <div class="row float-end">
      <div class="col-12">
        <div class="holder"></div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para editar la información del curso -->
<div class="modal fade" id="modal_curso" tabindex="-1" aria-labelledby="modal_curso" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Editar Curso</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="{{url_for('cursos.actualizar_curso')}}" method="POST">
          <input type="hidden" id="id_curso" name="id_curso">
          <div class="mb-3">
            <label for="nombre_curso" class="form-label">Nombre del curso</label>
            <input type="text" class="form-control" id="nombre_curso" name="nombre_curso"
              placeholder="Nombre del curso" required>
          </div>
          
          <div class="mb-3">
            <label for="codigo_curso" class="form-label">Código del curso</label>
            <input type="text" class="form-control" id="codigo_curso" name="codigo_curso"
              placeholder="Código del curso" required>
          </div>
          <div class="mb-3">
            <label for="fecha_inicio" class="form-label">Fecha de inicio</label>
            <input type="date" class="form-control" id="fecha_inicio" name="fecha_inicio" placeholder="Fecha de inicio">
          </div>
          <div class="mb-3">
            <label for="fecha_finalizacion" class="form-label">Fecha de finalización</label>
            <input type="date" class="form-control" id="fecha_finalizacion" name="fecha_finalizacion"
              placeholder="Fecha de finalización" required>
          </div>
          <div class="mb-3">
            <label for="horario" class="form-label">Horario</label>
            <input type="text" class="form-control" id="horario" name="horario" placeholder="Horario" required>
          </div>
          <div class="mb-3">
            <label for="duracion" class="form-label">Duración</label>
            <input type="text" class="form-control" id="duracion" name="duracion" placeholder="Duración" required>
          </div>
          <div class="mb-3">
            <label for="intensidad_horaria" class="form-label">Intensidad horaria</label>
            <input type="text" class="form-control" id="intensidad_horaria" name="intensidad_horaria"
              placeholder="Intensidad horaria" required>
          </div>
          <div class="mb-3">
            <label for="cantidad_sesiones" class="form-label">Cantidad de sesiones</label>
            <input type="text" class="form-control" id="cantidad_sesiones" name="cantidad_sesiones"
              placeholder="Cantidad de sesiones" required>
          </div>
          <div class="mb-3">
            <label for="cupo" class="form-label">Cupo</label>
            <input type="text" class="form-control" id="cupo" name="cupo" placeholder="Cupo" required>
          </div>
          <div class="mb-3">
            <label for="enlace_clase" class="form-label">Enlace de la clase</label>
            <input type="text" class="form-control" id="enlace_clase" name="enlace_clase"
              placeholder="Enlace de la clase" required>
          </div>
          <div class="mb-3">
            <label for="enlace_grabacion" class="form-label">Enlace de las grabaciones</label>
            <input type="text" class="form-control" id="enlace_grabacion" name="enlace_grabacion"
              placeholder="Enlace de las grabaciones" required>
          </div>
          <div class="mb-3">
            <label for="enlace_formulario" class="form-label">Enlace formulario asistencia</label>
            <input type="text" class="form-control" id="enlace_formulario" name="enlace_formulario"
              placeholder="Enlace del formulario" required>
          </div>


        </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" class="btn btn-primary"
              onclick="return confirm('¿Seguro/a que desea guardar los cambios?')">Guardar cambios</button>
          </div>
        </form>
    </div>
  </div>
</div>


<script>
  $('#modal_curso').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget) // Button that triggered the modal
    var recipient = button.data('bs-whateve') // Extract info from data-* attributes
    // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
    // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
    var modal = $(this)
    // modal.find('.modal-title').text('Editar docente ' + recipient)
    modal.find('.modal-body input#id_curso').val(recipient)
    // ajax petition
    $.ajax({
      url: '{{url_for("cursos.consultar_curso")}}',
      type: 'POST',
      data: {
        id_curso: recipient
      },
      success: function (response) {
        var curso = response
        modal.find('.modal-body input#nombre_curso').val(curso.nombre_curso)
        modal.find('.modal-body input#codigo_curso').val(curso.codigo_curso)
        modal.find('.modal-body input#fecha_inicio').val(curso.fecha_inicio)
        modal.find('.modal-body input#fecha_finalizacion').val(curso.fecha_fin)
        modal.find('.modal-body input#horario').val(curso.horario)
        modal.find('.modal-body input#duracion').val(curso.duracion)
        modal.find('.modal-body input#intensidad_horaria').val(curso.intensidad_horaria)
        modal.find('.modal-body input#cantidad_sesiones').val(curso.cantidad_sesiones)
        modal.find('.modal-body input#cupo').val(curso.cupo_curso)
        modal.find('.modal-body input#enlace_clase').val(curso.enlace_clase)
        modal.find('.modal-body input#enlace_grabacion').val(curso.enlace_grabaciones)
        modal.find('.modal-body input#enlace_formulario').val(curso.enlace_asistencia)

      }

    })
  })

</script>

<script
  src="https://cdn.jsdelivr.net/gh/luis-almeida/jPages@b6a51c90640c95d8ea4238f9196741eb9fb61531/js/jPages.js"></script>
<script>
  // Barra de busqueda para filtrar las cards basada en el titulo y ordenarlos en la pantalla
  $(document).ready(function () {
    $("#Buscar").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $(".titulo").filter(function () {
        $(this).parent().parent().parent().toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });
  // Paginacion de las cards de los cursos 
  $(function () {
    $("div.holder").jPages({
      containerID: "listado",
      perPage: 6,
      midRange: 3,
      startPage: 1,
      startRange: 1,
      endRange: 1,
      previous: "←",
      next: "→",
      delay: 50,
    });
  });
</script>
{%endblock%}
{%block footer%}

<!-- footer -->
<footer class="text-center text-white fondo_navbar">
  <!-- Grid container -->
  <div class="container pt-4">
    <!-- Section: Social media -->
    <section class="mb-4">
      <!-- Facebook -->
      <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="#!" role="button" data-mdb-ripple-color="dark">
        <i class="bi bi-facebook-f"></i></a>

      <!-- Twitter -->
      <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="#!" role="button" data-mdb-ripple-color="dark"><i
          class="bi bi-twitter"></i></a>

      <!-- Google -->
      <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="#!" role="button" data-mdb-ripple-color="dark"><i
          class="bi bi-google"></i></a>

      <!-- Instagram -->
      <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="#!" role="button" data-mdb-ripple-color="dark"><i
          class="bi bi-instagram"></i></a>

      <!-- Linkedin -->
      <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="#!" role="button" data-mdb-ripple-color="dark"><i
          class="bi bi-linkedin"></i></a>
      <!-- Github -->
      <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="#!" role="button" data-mdb-ripple-color="dark"><i
          class="bi bi-github"></i></a>
    </section>
    <!-- Section: Social media -->
  </div>
  <!-- Grid container -->

  <!-- Copyright -->
  <div class="text-center text-dark p-3" style="background-color: rgba(0, 0, 0, 0.2);">
    © 2020 Copyright:
    <a class="text-dark" href="https://mdbootstrap.com/">MDBootstrap.com</a>
  </div>
  <!-- Copyright -->
</footer>

{%endblock%}